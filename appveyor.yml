version: Build {build}
branches:
  only:
  - master
  - dev
skip_branch_with_pr: false
image: Visual Studio 2017
environment:
  clientSecret:
    secure: u2MqrnmS+4jSw1IQjBViTCmrVJ5OUo8bvswGz3HcF4L+qX2ZPYNrPRSKfOpWMUvr
build_script:
- ps: .\Build\Build.ps1
artifacts:
- path: '\Build\AppxPackages'
  name: AppxPackages
deploy_script:
- ps: >-
    if ($env:APPVEYOR_REPO_BRANCH -eq "master")
    {
        Add-AppveyorCompilationMessage "Publishing to Windows Store. " -Category Information
        if (-not [String]::IsNullOrEmpty($env:clientSecret))
        {
            .\Publish\InstallStoreBroker.ps1
            .\Publish\AppVeyorInit.ps1
            try
            {
                .\Publish\PublishToStore.ps1
            }
            catch
            {
                Add-AppveyorCompilationMessage "Publishing to Store failed. " -Category Error
            }
        }
        else
        {
            Add-AppveyorCompilationMessage "Environment variable clientSecret is not set. " -Category Error 
        }
    }
